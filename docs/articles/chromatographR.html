<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="chromatographR">
<title>chromatographR • chromatographR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="chromatographR">
<meta property="og:description" content="chromatographR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">chromatographR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/chromatographR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ethanbass/chromatographR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>chromatographR</h1>
                        <h4 data-toc-skip class="author">Ethan Bass</h4>
            
            <h4 data-toc-skip class="date">2022-04-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ethanbass/chromatographR/blob/HEAD/vignettes/chromatographR.Rmd" class="external-link"><code>vignettes/chromatographR.Rmd</code></a></small>
      <div class="d-none name"><code>chromatographR.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><em>chromatographR</em> is a package for the reproducible analysis of HPLC-DAD data in <code>R</code>. Liquid chromatography coupled to diode-array detection (HPLC-DAD) remains one of the most popular analytical methodologies due to its convenience and low-cost. However, there are currently few open-source tools available for analyzing HPLC-DAD chromatograms. The use of proprietary software for the analysis of HPLC-DAD data is currently a significant barrier to reproducible science, since these tools are not widely accessible, but also because such tools often require the user to select complicated options through a graphical interface which cannot easily be repeated. Reproducibility is of course much higher in command line workflows, like <em>chromatographR</em> where the entire analysis can be stored and easily repeated by anyone using publicly available software.</p>
<p>The <em>chromatographR</em> package draws inspiration from the previously published <em>alsace</em> package <span class="citation">(Wehrens, Carvalho, and Fraser 2015)</span>, but with improved functions for peak-finding, integration and peak table generation as well as a number of new tools for data visualization and checking. Unlike <em>alsace</em>, which emphasized multivariate curve resolution through alternating least squares (MCR-ALS), <em>chromatographR</em> focuses on a more conventional workflow that may seem more familiar to users of standard software tools for HPLC-DAD analysis. <em>chromatographR</em> includes tools for a) pre-processing, b) retention-time alignment, c) peak-finding, d) peak-integration and e) peak-table construction, as well as additional functions useful in analysis of the resulting peak table.</p>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<div class="section level3">
<h3 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h3>
<p>In most cases, the data coming from the spectrometer must first be converted into an <code>R</code>-accessible format such as a <code>csv</code> file. Once all <code>csv</code> files are gathered into a single directory (e.g. <code>foo</code>), the <code>load_chromes</code> function provides a simple interface to import your chromatograms.</p>
<pre class="text"><code>&gt; # single folder
&gt; load_chroms(paths = path)
&gt; 
&gt; # multiple folders
&gt; path = 'foo'
&gt; folders &lt;- list.files(path = path, pattern = "EXPORT3D")
&gt; dat &lt;- load_chroms(folders)</code></pre>
</div>
<div class="section level3">
<h3 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h3>
<p>We have included some example data consisting of root extracts from tall goldenrod (<em>Solidago altissima</em>).</p>
<pre class="text"><code>&gt; data(sa_shorter)</code></pre>
<pre><code>Warning in data(sa_shorter): data set 'sa_shorter' not found</code></pre>
</div>
<div class="section level3">
<h3 id="pre-processing-data">Pre-processing data<a class="anchor" aria-label="anchor" href="#pre-processing-data"></a>
</h3>
<p>Experimental data can suffer from a number of non-informative artifacts, such as noise (random or non- random), a shifting baseline, or missing values. In addition, the data produced by the instrument may have longer wavelength or time ranges (or higher resolution) than we need. Since HPLC-DAD data are fairly smooth, it is relatively easy to correct these issues in most cases. For example, smoothing can remove much of the noise in the spectral direction and baseline subtraction can correct a shifting baseline. Selection and interpolation can be used to select the time and wavelength ranges and resolutions we want. All of these functions are available through the <code>preprocess</code> function. Smoothing and baseline subtraction are enabled by default, and providing alternative sets of time points and/or wavelengths will lead to sub-sampling and subsequent interpolation along one or both axes. This can significantly reduce the computational load in later steps.</p>
<p>The <code>baseline_cor</code> function from the <em>ptw</em> package <span class="citation">(Bloemberg et al. 2010)</span> takes arguments <code>p</code> (an asymmetry parameter) and <code>lambda</code> (a smoothing parameter). You can read more about these in the documentation for <code><a href="https://rdrr.io/pkg/ptw/man/asysm.html" class="external-link">ptw::asysm</a></code>. You may want to experiment with these parameters before choosing values to use on your whole dataset.</p>
<pre class="text"><code>&gt; i=2 # chromatogram number in list of data
&gt; tpoints &lt;- as.numeric(rownames(Sa[[i]]))
&gt; lambda='200.00000'
&gt; 
&gt; matplot(x=tpoints, y=Sa[[i]][,lambda],
+        type='l', ylab='Abs (mAU)', xlab='Time (min)')
&gt; matplot(x=tpoints, y = ptw::baseline.corr(Sa[[i]][,lambda],p=.001,lambda=1e5),
+        type='l', add = T, col='blue', lty = 3)</code></pre>
<p><img src="chromatographR_files/figure-html/choosing%20parameters-1.png" width="576"></p>
<pre class="text"><code>&gt; new.ts &lt;- seq(10,18.66,by=.01) # choose time-points
&gt; new.lambdas &lt;- seq(200, 318, by = 2) # choose wavelengths</code></pre>
<pre class="text"><code>&gt; dat.pr &lt;- preprocess(Sa, dim1=new.ts, dim2=new.lambdas,
+            parallel=F, p=.001, lambda=1e5)</code></pre>
<p>After loading data, you may want to normalize your chromatograms (e.g. by sample mass). However, you can also normalize after assembling the peak table.</p>
</div>
<div class="section level3">
<h3 id="dealing-with-retention-time-shifts">Dealing with retention time shifts<a class="anchor" aria-label="anchor" href="#dealing-with-retention-time-shifts"></a>
</h3>
<p>In many cases, HPLC data can suffer from retention time shifts (e.g. due to temperature fluctuations, column degradation, or subtle changes in mobile-phase composition). Parametric time warping (as implemented in the <em>ptw</em> package can be quite an effective technique for correcting subtle retention time shifts <span class="citation">(Eilers 2004)</span>. If your chromatograms are already perfectly aligned you can skip this step. If you have severe retention time shifts this technique will be considerably less effective (and you should consider checking your HPLC for leaks).</p>
<p>The <code>correct_rt</code> function is a wrapper around the <code>ptw</code> function. For each chromatogram, it produces a “global” warping function across all wavelengths included in <code>lambdas</code>). The goal of the warping function is to produce a better alignment of retention times by “warping” the time-axis of each chromatogram to match a reference chromatogram. The reference chromatogram can be selected manually or determined algorithmically by setting the <code>reference</code> argument. The code below creates warping models for the samples in the provided list of data matrices. The same function can then be used to warp each chromatogram according to the corresponding model, by setting the <code>models</code> parameter.</p>
<pre class="text"><code>&gt; warping.models &lt;- correct_rt(dat.pr, what = "models", lambdas=c('210','260','318'))
&gt; warp &lt;- correct_rt(chrom_list=dat.pr, models=warping.models)</code></pre>
<p>You can see that, in this case, the alignment is considerably improved after warping.</p>
<pre class="text"><code>&gt; par(mfrow=c(2,1))
&gt; lambdas=c('210','260')
&gt; plot.new()
&gt; plot.window(xlim=c(head(new.ts,1),tail(new.ts,1)),ylim=c(0,1000))
&gt; for (i in 1:length(warp)){
+   matplot(new.ts, warp[[i]][,lambdas],type='l',add=T)
+ }
&gt; legend("topright", legend="warped", cex=0.7, bty = "n")
&gt; 
&gt; plot.new()
&gt; plot.window(xlim=c(head(new.ts,1),tail(new.ts,1)),ylim=c(0,1000))
&gt; for (i in 1:length(dat.pr)){
+   matplot(new.ts, dat.pr[[i]][,lambdas],type='l',add=T)
+ }
&gt; legend("topright", legend="raw", cex=0.7, bty = "n")</code></pre>
<p><img src="chromatographR_files/figure-html/alignment_plot-1.png" width="576"></p>
<p>It can sometimes be informative to also plot the warping coefficients (e.g. to find outliers), which you can be easily accomplished using the method shown below:</p>
<pre class="text"><code>&gt; #par(mfrow=c(3,1))
&gt; coef &lt;- sapply(warping.models,function(x) x$warp.coef)
&gt; plot(coef[1,],pch=20,xlab='',ylab='')
&gt; plot(coef[2,],pch=20,xlab='',ylab='')
&gt; plot(coef[3,],pch=20,xlab='',ylab='')</code></pre>
<p><img src="chromatographR_files/figure-html/plot%20coefficients-1.png" width="30%"><img src="chromatographR_files/figure-html/plot%20coefficients-2.png" width="30%"><img src="chromatographR_files/figure-html/plot%20coefficients-3.png" width="30%"></p>
</div>
<div class="section level3">
<h3 id="peak-finding-and-fitting">Peak finding and fitting<a class="anchor" aria-label="anchor" href="#peak-finding-and-fitting"></a>
</h3>
<p>The <code>get_peaks</code> function loops through your chromatograms at the specified wavelengths, finds peaks, and attempts to fit them to the specified function using non-linear least squares – the current options are <code>gaussian</code> and <code>egh</code> (exponential-gaussian hybrid) <span class="citation">(Lan and Jorgenson 2001)</span>. The area under the curve for each peak is then estimated using a trapezoidal approximation method. The function returns a nested list of dataframes containing information about the peaks in each chromatogram.</p>
<pre class="text"><code>&gt; pks_gauss &lt;- get_peaks(warp, lambdas = c('210','260'), sd.max=40, fit="gaussian")
&gt; pks_egh &lt;- get_peaks(warp, lambdas = c('210', '260'), sd.max=40, fit="egh")</code></pre>
<p>The <code>plot.peak_list</code> function allows you to visually assess the peak integration accuracy. Below we compare the peaks fitted for the first chromatogram (<code>index=1</code>) using the two algorithms. Usually the egh function performs slightly better for asymmetrical peaks.</p>
<pre class="text"><code>&gt; par(mfrow=c(2,1))
&gt; plot(pks_gauss, index=1, lambda='210')
&gt; plot(pks_egh, index=1, lambda='210')</code></pre>
<p><img src="chromatographR_files/figure-html/plot_peaks-1.png" width="576"></p>
<pre class="text"><code>&gt; pk_tab &lt;- get_peaktable(pks_egh, response = "area")</code></pre>
<pre><code>Warning in FUN(X[[i]], ...): More than one peak of one injection in the same cluster
for component 1.
Keeping only the most intense one.</code></pre>
<pre><code>Warning in FUN(X[[i]], ...): More than one peak of one injection in the same cluster
for component 2.
Keeping only the most intense one.</code></pre>
<pre class="text"><code>&gt; head(pk_tab$tab[,1:6])</code></pre>
<pre><code>          X1        X2        X3       X4        X5        X6
119 547.5999   0.00000  64.73611 188.9210 1514.4775  31.08266
121 426.2768 109.41736  61.30032   0.0000  800.6312   0.00000
122 839.5934  94.67302 199.57845   0.0000 2595.0200 179.59510
458 620.1729 228.73095 198.89770 530.8515 1399.5000  28.75473</code></pre>
</div>
<div class="section level3">
<h3 id="additional-useful-tools">Additional useful tools<a class="anchor" aria-label="anchor" href="#additional-useful-tools"></a>
</h3>
<div class="section level4">
<h4 id="plotting-spectra">Plotting spectra<a class="anchor" aria-label="anchor" href="#plotting-spectra"></a>
</h4>
<p>The <code>plot_spectrum</code> function allows you to easily plot or record the spectra associated with a particular peak in your peak table. This is useful for interpreting your results and/or checking for errors in your peak table. For example, you may want to check if the spectra match for a particular peak in your peak table. Or you may just want to have a look at the spectrum for a peak of interest. The <code>plot_spectrum</code> function can be used to plot only the spectrum or only the chromatographic trace using the arguments <code>plot_spectrum</code> and <code>plot_trace</code>. By default it will plot data from the chromatogram with the biggest peak in the peak table, but you can choose the chromatogram (and the wavelength for the trace) using the <code>chr</code> and <code>lambda</code> arguments.</p>
<pre class="text"><code>&gt; par(mfrow=c(2,1))
&gt; peak="X8"
&gt; plot_spectrum(peak, peak_table = pk_tab, chrom_list = warp)</code></pre>
<pre><code>[1] "chrome no. 4; RT: 12.59; lambda = 202 nm"</code></pre>
<p><img src="chromatographR_files/figure-html/plot%20spectra-1.png" width="576"></p>
<pre class="text"><code>&gt; peak="X23"
&gt; plot_spectrum(peak, peak_table=pk_tab, chrom_list = warp)</code></pre>
<pre><code>[1] "chrome no. 2; RT: 16.25; lambda = 200 nm"</code></pre>
<p><img src="chromatographR_files/figure-html/plot%20spectra-2.png" width="576"></p>
<p>The <code>plot_all_spectra</code> function can be used to visually compare peaks at a given column of the peak table to confirm that they match.</p>
<pre class="text"><code>&gt; peak="X8"
&gt; plot_all_spectra(peak, peak_table=pk_tab, chrom_list = warp, export=F, overlapping=T)</code></pre>
<p><img src="chromatographR_files/figure-html/plot_all-1.png" width="576"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bloemberg2010" class="csl-entry">
Bloemberg, Tom G., Jan Gerretzen, Hans J. P. Wouters, Jolein Gloerich, Maurice van Dael, Hans J. C. T. Wessels, Lambert P. van den Heuvel, Paul H. C. Eilers, Lutgarde M. C. Buydens, and Ron Wehrens. 2010. <span>“Improved Parametric Time Warping for Proteomics.”</span> <em>Chemometrics and Intelligent Laboratory Systems</em>, <span>OMICS</span>, 104 (1): 65–74. <a href="https://doi.org/10.1016/j.chemolab.2010.04.008" class="external-link">https://doi.org/10.1016/j.chemolab.2010.04.008</a>.
</div>
<div id="ref-eilers2004" class="csl-entry">
Eilers, Paul H. C. 2004. <span>“Parametric <span>Time Warping</span>.”</span> <em>Analytical Chemistry</em> 76 (2): 404–11. <a href="https://doi.org/10.1021/ac034800e" class="external-link">https://doi.org/10.1021/ac034800e</a>.
</div>
<div id="ref-lan2001" class="csl-entry">
Lan, Kevin, and James W. Jorgenson. 2001. <span>“A Hybrid of Exponential and Gaussian Functions as a Simple Model of Asymmetric Chromatographic Peaks.”</span> <em>Journal of Chromatography A</em> 915 (1): 1–13. <a href="https://doi.org/10.1016/S0021-9673(01)00594-5" class="external-link">https://doi.org/10.1016/S0021-9673(01)00594-5</a>.
</div>
<div id="ref-wehrens2015" class="csl-entry">
Wehrens, Ron, Elisabete Carvalho, and Paul D. Fraser. 2015. <span>“Metabolite Profiling in <span>LC</span> Using Multivariate Curve Resolution: The Alsace Package for <span>R</span>.”</span> <em>Metabolomics</em> 11 (1): 143–54. <a href="https://doi.org/10.1007/s11306-014-0683-5" class="external-link">https://doi.org/10.1007/s11306-014-0683-5</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ethan Bass.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
